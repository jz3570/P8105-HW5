---
title: "P8105"
author: "Jiawen Zhao"
date: "11/3/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggridges)
library(patchwork)
library(gridExtra)
```

#### Problem 2
```{r}
homicide <- read.csv("./data/homicide-data.csv")%>% 
  na.omit() %>% 
  unite(city_state, c(city,state),sep = ", ") %>% 
  mutate(solved = case_when(grepl("Closed", disposition)==TRUE ~ 1,
  grepl("Closed", disposition)==FALSE ~ 0)) %>% 
  mutate(unsolved = case_when(grepl("Open", disposition)==TRUE ~ 1,
  grepl("Open", disposition)==FALSE ~ 0)) 
homicide_summary = group_by(homicide,city_state) %>% 
  summarise(total_solved = sum(solved),
            total_unsolved = sum(unsolved))
BMD = filter(homicide_summary,city_state=="Baltimore, MD")
result = prop.test(BMD$total_unsolved, BMD$total_solved+BMD$total_unsolved)
broom::tidy(result)

prop_test_results = function(x,n) {
  result = prop.test(x, n)
  broom::tidy(result)
}



sim_results_df = 
  homicide_summary %>% 
  mutate(
    estimate_df = 
      map2(.x = total_unsolved, .y = total_solved+total_unsolved, ~prop_test_results(x = .x, n = .y))
  ) %>% 
  unnest(estimate_df)
  

sim_results_df %>% 
  ggplot(aes(x = city_state, y = estimate)) + 
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2)+
  scale_x_discrete(guide = guide_axis(angle = 90))+
  geom_point()
```

